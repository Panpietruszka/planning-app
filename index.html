<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architect Pro | Visual Hierarchy Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');

        :root {
            --bg: #050505;
            --accent: #0071e3;
            --cursor-size: 15px;
            --cursor-bg: rgba(255, 255, 255, 0.3);
        }

        *, *::before, *::after {
            cursor: none !important;
        }

        html, body {
            cursor: none !important;
            height: 100%;
            margin: 0;
        }

        body {
            background-color: var(--bg);
            color: #e5e5e5;
            font-family: 'Plus Jakarta Sans', sans-serif;
            overflow-y: auto;
        }
        #custom-cursor {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--cursor-size);
            height: var(--cursor-size);
            background-color: var(--cursor-bg);
            border: 1.5px solid rgba(0, 0, 0, 0.9);
            border-radius: 50%;
            pointer-events: none;
            z-index: 99999;
            transition: 
                width 0.3s cubic-bezier(0.2, 0.8, 0.2, 1),
                height 0.3s cubic-bezier(0.2, 0.8, 0.2, 1),
                background-color 0.3s ease,
                border-color 0.3s ease,
                opacity 0.2s ease,
                border-radius 0.3s ease,
                transform 0.15s ease-out;
            transform: translate(-50%, -50%);
            will-change: transform, width, height, top, left;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            /* Zapewniamy, ≈ºe sam kursor nie "blokuje" myszki */
            user-select: none;
        }

        #custom-cursor.magnetic {
            background-color: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(4px);
        }

        #custom-cursor.text {
            width: 1.5px;
            height: 20px;
            background-color: #0a84ff;
            border: none;
            box-shadow: none;
            border-radius: 2px;
        }

        #custom-cursor.clicking {
            transform: translate(-50%, -50%) scale(0.7) !important;
            background-color: rgba(255, 255, 255, 0.6);
        }

        .cursor-hidden { opacity: 0; }

        .dark-glass {
            background: rgba(28, 28, 30, 0.85);
            backdrop-filter: blur(40px) saturate(160%);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .todo-item {
            background: rgba(44, 44, 46, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.04);
            transition: all 0.2s ease;
        }

        input::placeholder { color: #636366; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { 
            background: rgba(255, 255, 255, 0.1); 
            border-radius: 10px; 
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 10px;
        }

        .app-layout {
            display: flex;
            min-height: 100vh;
        }

        aside.sidebar-container {
            width: 300px;
            flex-shrink: 0;
            position: sticky;
            top: 0;
            height: 100vh;
        }

        main {
            flex-grow: 1;
            min-width: 0;
        }

        /* ZMODYFIKOWANY EDYTOR JAKO P≈ÅYWAJƒÑCE OKNO */
        #editor-aside {
            width: 400px;
            position: fixed;
            top: 150px;
            right: 50px;
            height: auto;
            max-height: 80vh;
            background: #0f0f0f;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 24px;
            box-shadow: 0 40px 80px rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            transition: opacity 0.3s ease;
        }

        #editor-header {
            cursor: move;
            padding: 20px 24px;
            background: #161616;
            border-radius: 24px 24px 0 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            user-select: none;
        }

        #editor-aside.translate-x-full {
            display: none;
            opacity: 0;
        }

        .item-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(255, 255, 255, 0.02);
            position: relative;
            cursor: pointer;
            overflow: hidden;
            min-width: 300px;
            max-width: 450px;
            flex: 1 1 300px;
        }

        .item-card:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: translateY(-4px);
            border-color: var(--accent);
        }

        .priority-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            display: inline-block;
            cursor: pointer;
            transition: transform 0.2s;
            border: 1px solid rgba(0, 0, 0, 0.2);
        }

        .dot-low {
            background: #28c840;
        }

        .dot-med {
            background: #febc2e;
        }

        .dot-high {
            background: #ff5f57;
        }

        .priority-dot.active {
            transform: scale(1.3);
            filter: brightness(1.2);
            border: 1.5px solid white;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }

        .card-priority-indicator {
            position: absolute;
            top: 12px;
            left: 12px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            z-index: 10;
        }

        .coll-arrow {
            transition: transform 0.2s;
            display: inline-block;
            cursor: pointer;
            width: 16px;
            font-size: 10px;
            color: #666;
        }

        .coll-arrow.open {
            transform: rotate(90deg);
            color: var(--accent);
        }

        .sub-folder {
            margin-left: 1.2rem;
            border-left: 1px solid rgba(255, 255, 255, 0.08);
            padding-left: 0.8rem;
        }

        .nav-item-entry {
            font-size: 13px;
            padding: 8px 12px;
            margin-left: 4px;
            color: #999;
            display: flex;
            align-items: center;
            gap: 10px;
            border-radius: 8px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .nav-item-entry:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        .nav-item-entry.active-item {
            color: #fff;
            background: rgba(0, 113, 227, 0.2);
            font-weight: 600;
        }

        #quick-add-window {
            position: fixed;
            top: 100px;
            left: 350px;
            width: 500px;
            z-index: 9999;
            background: #0f0f0f;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        #qa-header {
            cursor: move;
            background: #161616;
            padding: 16px 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .type-pill {
            padding: 8px 16px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 800;
            border: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            opacity: 0.4;
            transition: 0.2s;
        }

        .type-pill.active {
            opacity: 1;
            border-color: var(--accent);
            background: rgba(0, 113, 227, 0.1);
            color: var(--accent);
        }

        .hidden {
            display: none !important;
        }

        .input-base {
            background: black;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 14px;
            font-size: 14px;
            outline: none;
            transition: 0.2s;
        }

        .input-base:focus {
            border-color: var(--accent);
        }
    </style>
</head>

<body>
    <div id="custom-cursor" class="cursor-hidden"></div>

    <div class="app-layout">
        <aside class="sidebar-container bg-[#0a0a0a] border-r border-white/5 p-6 flex flex-col">
            <div class="flex items-center gap-3 mb-10">
                <div class="w-10 h-10 bg-blue-600 rounded-xl shadow-lg shadow-blue-500/20"></div>
                <span class="font-bold tracking-tighter text-white uppercase text-[12px] tracking-[0.25em]">Architect
                    Pro</span>
            </div>

            <button id="btn-new-coll"
                class="w-full py-4 bg-white text-black text-[12px] font-black rounded-xl mb-8 hover:bg-blue-500 hover:text-white transition-all shadow-xl">+
                NOWA KOLEKCJA</button>
            <div id="new-proj-box" class="hidden mb-6"><input id="proj-name-in" type="text" class="input-base w-full"
                    placeholder="Nazwa i Enter..."></div>

            <nav class="space-y-2 mb-10">
                <button id="nav-all"
                    class="w-full flex items-center justify-between p-3 text-[14px] font-medium text-gray-300 hover:bg-white/5 rounded-xl transition-colors">
                    <div class="flex items-center gap-3"><span>üìÇ</span> Wszystkie</div>
                    <span id="count-all" class="text-[11px] opacity-40 font-mono">0</span>
                </button>
                <button id="nav-favs"
                    class="w-full flex items-center justify-between p-3 text-[14px] font-medium text-gray-300 hover:bg-white/5 rounded-xl transition-colors">
                    <div class="flex items-center gap-3"><span>‚≠ê</span> Ulubione</div>
                </button>
            </nav>

            <div class="flex-1 overflow-y-auto">
                <div class="text-[10px] text-gray-600 font-bold tracking-widest uppercase mb-6 px-3">Struktura bazy
                </div>
                <div id="project-nav" class="space-y-2"></div>
            </div>
        </aside>

        <main class="flex flex-col relative">
            <header
                class="p-5 border-b border-white/5 flex gap-5 items-center bg-[#050505]/80 backdrop-blur-md sticky top-0 z-20">
                <input type="text" id="global-search" placeholder="Szukaj zasob√≥w lub tag√≥w..."
                    class="flex-1 bg-white/[0.03] border border-white/10 rounded-2xl py-3 px-7 text-sm outline-none focus:border-blue-500/50">

                <div class="flex gap-3 items-center">
                    <div class="flex gap-1 bg-white/5 p-1.5 rounded-xl mr-2">
                        <button class="view-filter px-4 py-2 rounded-lg text-[11px] font-bold bg-blue-600"
                            data-type="all">ALL</button>
                        <button class="view-filter px-4 py-2 rounded-lg text-[11px] font-bold"
                            data-type="link">LINKS</button>
                        <button class="view-filter px-4 py-2 rounded-lg text-[11px] font-bold"
                            data-type="file">FILES</button>
                    </div>

                    <label
                        class="bg-white/5 hover:bg-blue-600 text-white p-3 rounded-2xl cursor-pointer transition-all border border-white/5 group">
                        <input type="file" id="file-upload-input" class="hidden" multiple accept="image/*">
                        <span class="text-lg group-hover:scale-110 block">üìé</span>
                    </label>

                    <button id="header-add-btn"
                        class="bg-blue-600 hover:bg-blue-500 text-white px-7 py-3 rounded-2xl text-[12px] font-black transition-all shadow-lg shadow-blue-600/20">+
                        DODAJ</button>
                </div>
            </header>

            <div id="feed-container" class="p-10 flex flex-wrap gap-8 h-full content-start overflow-y-auto"></div>
        </main>

        <aside id="editor-aside" class="translate-x-full">
            <div id="editor-header" class="flex justify-between items-center">
                <h2 class="font-bold text-[11px] tracking-[0.2em] text-blue-500 uppercase">Edytor Zasobu</h2>
                <button id="close-editor"
                    class="text-[11px] opacity-40 hover:opacity-100 uppercase font-black">Zamknij</button>
            </div>
            <div class="p-8 flex flex-col flex-1 overflow-hidden">
                <div id="editor-form" class="space-y-8 flex-1 overflow-y-auto pr-2"></div>
                <div class="pt-8 border-t border-white/5 space-y-4">
                    <button id="update-item-btn"
                        class="w-full bg-blue-600 py-4 rounded-2xl text-[12px] font-black hover:bg-blue-500 transition-all shadow-xl">AKTUALIZUJ
                        ZMIANY</button>
                    <button id="delete-item-btn"
                        class="w-full bg-red-600/10 text-red-500 py-4 rounded-2xl text-[11px] font-bold hover:bg-red-600 hover:text-white transition-all">USU≈É
                        TRWALE</button>
                </div>
            </div>
        </aside>
    </div>

    <div id="quick-add-window" class="hidden">
        <div id="qa-header" class="flex justify-between items-center">
            <div class="flex gap-2 items-center">
                <div class="flex gap-2 mr-3">
                    <div class="w-4 h-4 rounded-full bg-[#ff5f57]"></div>
                    <div class="w-4 h-4 rounded-full bg-[#febc2e]"></div>
                    <div class="w-4 h-4 rounded-full bg-[#28c840]"></div>
                </div>
                <span class="text-[10px] font-black tracking-widest text-gray-500 uppercase">Power Add Engine</span>
            </div>
            <button id="qa-close-x" class="text-gray-500 hover:text-white text-2xl">&times;</button>
        </div>
        <div class="p-8 flex flex-col gap-8">
            <div class="flex justify-between items-end">
                <div class="space-y-3">
                    <p class="text-[10px] font-bold text-gray-500 uppercase">Typ Zasobu</p>
                    <div class="flex gap-3" id="qa-type-container">
                        <div class="type-pill active" data-type="link">LINK</div>
                        <div class="type-pill" data-type="text">NOTE</div>
                        <div class="type-pill" data-type="code">CODE</div>
                    </div>
                </div>
                <div class="flex gap-4 bg-black/40 p-3 rounded-full border border-white/5" id="qa-prio-container">
                    <div class="priority-dot dot-low" data-prio="low"></div>
                    <div class="priority-dot dot-med active" data-prio="med"></div>
                    <div class="priority-dot dot-high" data-prio="high"></div>
                </div>
            </div>
            <textarea id="qa-content" placeholder="Wpisz tre≈õƒá, notatkƒô lub wklej link..."
                class="w-full h-40 input-base resize-none"></textarea>
            <input id="qa-tags" type="text" placeholder="Tagi (po przecinku)..." class="w-full input-base">
            <button id="qa-save"
                class="w-full bg-blue-600 py-5 rounded-2xl text-[12px] font-black uppercase tracking-widest shadow-2xl">Archiwizuj
                w bazie</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, onSnapshot, updateDoc, deleteDoc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBvYHO1sYbPw35VRai37By4sqz0OKnml_0",
            authDomain: "architect-pro-839a5.firebaseapp.com",
            projectId: "architect-pro-839a5",
            storageBucket: "architect-pro-839a5.firebasestorage.app",
            messagingSenderId: "970538126376",
            appId: "1:970538126376:web:1d41594e31f0f9c19c391d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let items = [];
        let collections = [];
        let activeCollection = 'all';
        let activeTypeFilter = 'all';
        let searchQuery = '';
        let expandedCollections = new Set();
        let currentEditId = null;
        let qaPrio = 'med';
        let qaType = 'link';
        let tempEditPrio = 'med';

        signInAnonymously(auth).then(() => {
            onSnapshot(collection(db, 'collections'), snap => {
                collections = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                renderSidebar();
            });
            const q = query(collection(db, 'raindrop_items'), orderBy('createdAt', 'desc'));
            onSnapshot(q, snap => {
                items = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                renderFeed();
                renderSidebar();
                if (currentEditId) window.openEditor(currentEditId);
            });
        });

        function renderSidebar() {
            const container = document.getElementById('project-nav');
            const rootFolders = collections.filter(c => !c.parentId || c.parentId === 'global');
            const countAll = document.getElementById('count-all');
            if (countAll) countAll.innerText = items.length;
            container.innerHTML = rootFolders.map(c => renderFolder(c)).join('');
        }

        function renderFolder(folder) {
            const isOpen = expandedCollections.has(folder.id);
            const subFolders = collections.filter(f => f.parentId === folder.id);
            const isActive = activeCollection === folder.id;
            const folderItems = items.filter(i => i.collectionId === folder.id);

            const itemsHtml = folderItems.map(item => {
                const icon = item.type === 'file' ? 'üìÑ' : (item.type === 'link' ? 'üîó' : 'üìù');
                const isItemActive = currentEditId === item.id;
                const displayContent = item.content ? (item.content.substring(0, 24) + (item.content.length > 24 ? '...' : '')) : 'Bez tytu≈Çu';
                return `
                    <div class="nav-item-entry ${isItemActive ? 'active-item' : ''}" onclick="event.stopPropagation(); window.openEditor('${item.id}')">
                        <span>${icon}</span>
                        <span class="truncate">${displayContent}</span>
                    </div>
                `;
            }).join('');

            return `
            <div class="folder-group mb-2">
                <div class="group flex items-center justify-between p-3 text-[14px] font-semibold rounded-xl cursor-pointer transition-all ${isActive ? 'bg-blue-600/10 text-blue-500' : 'text-gray-400 hover:bg-white/5'}" onclick="window.setCollection('${folder.id}')">
                    <div class="flex items-center gap-3 truncate">
                        <span class="coll-arrow ${isOpen ? 'open' : ''}" onclick="window.toggleExpand(event, '${folder.id}')">‚ñ∂</span>
                        <span class="truncate">${folder.isAutoGenerated ? 'üìÅ' : 'üì¶'} ${folder.name.toUpperCase()}</span>
                    </div>
                </div>
                ${isOpen ? `
                    <div class="sub-folder">
                        ${subFolders.map(sf => renderFolder(sf)).join('')}
                        <div class="folder-items-container mt-2 mb-3">
                            ${itemsHtml}
                        </div>
                    </div>
                ` : ''}
            </div>`;
        }

        function renderFeed() {
            const container = document.getElementById('feed-container');
            const filtered = items.filter(i => {
                const contentLower = (i.content || '').toLowerCase();
                const matchSearch = contentLower.includes(searchQuery.toLowerCase());
                const matchColl = activeCollection === 'all' ? true : (activeCollection === 'favs' ? i.isFav : i.collectionId === activeCollection);
                const matchType = activeTypeFilter === 'all' ? true : i.type === activeTypeFilter;
                return matchSearch && matchColl && matchType;
            });

            container.innerHTML = filtered.map(i => {
                const pClass = i.priority === 'high' ? 'dot-high' : (i.priority === 'low' ? 'dot-low' : 'dot-med');
                return `
                <div class="item-card p-6 rounded-3xl flex flex-col gap-5 group" onclick="window.openEditor('${i.id}')">
                    <div class="card-priority-indicator ${pClass}"></div>
                    ${i.preview ? `<div class="h-48 -mx-6 -mt-6 mb-2 overflow-hidden bg-black flex items-center justify-center border-b border-white/5"><img src="${i.preview}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity"></div>` : ''}
                    <div class="flex justify-between items-start">
                        <div class="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center text-lg">
                            ${i.type === 'file' ? (i.preview ? 'üñºÔ∏è' : 'üìÑ') : (i.type === 'link' ? 'üîó' : 'üìù')}
                        </div>
                        <button class="text-xl" onclick="event.stopPropagation(); window.toggleFav('${i.id}', ${i.isFav})">${i.isFav ? '‚≠ê' : '‚òÜ'}</button>
                    </div>
                    <p class="text-sm ${i.type === 'link' ? 'text-blue-400' : 'text-gray-300'} line-clamp-4 font-medium leading-relaxed">${i.content}</p>
                </div>`;
            }).join('');
        }

        window.openEditor = (id) => {
            currentEditId = id;
            const item = items.find(i => i.id === id);
            if (!item) return;
            tempEditPrio = item.priority;

            const editorAside = document.getElementById('editor-aside');
            editorAside.classList.remove('translate-x-full');

            document.getElementById('editor-form').innerHTML = `
                ${item.preview ? `<img src="${item.preview}" class="w-full rounded-2xl mb-6 border border-white/10 shadow-2xl">` : ''}
                <div class="space-y-4">
                    <p class="text-[10px] font-bold text-gray-500 uppercase tracking-widest">Priorytet Zasobu</p>
                    <div class="flex gap-5 bg-black p-5 rounded-2xl border border-white/5">
                        <div class="priority-dot dot-low ${tempEditPrio === 'low' ? 'active' : ''}" onclick="window.setEditPrio('low')"></div>
                        <div class="priority-dot dot-med ${tempEditPrio === 'med' ? 'active' : ''}" onclick="window.setEditPrio('med')"></div>
                        <div class="priority-dot dot-high ${tempEditPrio === 'high' ? 'active' : ''}" onclick="window.setEditPrio('high')"></div>
                    </div>
                </div>
                <textarea id="edit-content" class="w-full h-56 input-base resize-none">${item.content}</textarea>
            `;
            renderSidebar();
        };

    window.setEditPrio = (p) => {
        tempEditPrio = p;
        document.querySelectorAll('#editor-form .priority-dot').forEach(d => {
            d.classList.toggle('active', d.classList.contains('dot-' + p));
        });
    };
        
        document.getElementById('update-item-btn').onclick = async () => {
            if (!currentEditId) return;
            const content = document.getElementById('edit-content').value;
            await updateDoc(doc(db, 'raindrop_items', currentEditId), {
                content: content,
                priority: tempEditPrio
            });
        };

        // USUWANIE
        document.getElementById('delete-item-btn').onclick = async () => {
            if (!currentEditId) return;
            if (confirm("Czy na pewno chcesz usunƒÖƒá ten zas√≥b?")) {
                await deleteDoc(doc(db, 'raindrop_items', currentEditId));
                document.getElementById('editor-aside').classList.add('translate-x-full');
                currentEditId = null;
            }
        };

        document.getElementById('qa-save').onclick = async () => {
            const content = document.getElementById('qa-content').value;
            const tags = document.getElementById('qa-tags').value.split(',').map(t => t.trim());
            if (!content) return alert("Wpisz tre≈õƒá!");
            await addDoc(collection(db, 'raindrop_items'), {
                content, type: qaType, priority: qaPrio, tags,
                collectionId: activeCollection === 'all' || activeCollection === 'favs' ? 'global' : activeCollection,
                isFav: false, createdAt: serverTimestamp()
            });
            document.getElementById('qa-content').value = '';
            document.getElementById('quick-add-window').classList.add('hidden');
        };

        document.querySelectorAll('#qa-prio-container .priority-dot').forEach(dot => {
            dot.onclick = () => {
                qaPrio = dot.dataset.prio;
                document.querySelectorAll('#qa-prio-container .priority-dot').forEach(d => d.classList.remove('active'));
                dot.classList.add('active');
            };
        });

        document.querySelectorAll('#qa-type-container .type-pill').forEach(pill => {
            pill.onclick = () => {
                qaType = pill.dataset.type;
                document.querySelectorAll('#qa-type-container .type-pill').forEach(p => p.classList.remove('active'));
                pill.classList.add('active');
            };
        });

        window.setCollection = (id) => { activeCollection = id; renderFeed(); renderSidebar(); };
        window.toggleExpand = (e, id) => { e.stopPropagation(); expandedCollections.has(id) ? expandedCollections.delete(id) : expandedCollections.add(id); renderSidebar(); };
        window.toggleFav = async (id, cur) => await updateDoc(doc(db, 'raindrop_items', id), { isFav: !cur });

        document.getElementById('close-editor').onclick = () => {
            document.getElementById('editor-aside').classList.add('translate-x-full');
            currentEditId = null;
            renderSidebar();
        };

        document.getElementById('header-add-btn').onclick = () => document.getElementById('quick-add-window').classList.remove('hidden');
        document.getElementById('qa-close-x').onclick = () => document.getElementById('quick-add-window').classList.add('hidden');

        // FUNKCJA PRZECIƒÑGANIA DLA OBU OKIEN
        function makeDraggable(el, handle) {
            let drag = false, ox, oy;
            handle.onmousedown = (e) => {
                drag = true;
                ox = e.clientX - el.offsetLeft;
                oy = e.clientY - el.offsetTop;
                el.style.transition = 'none'; // Wy≈ÇƒÖczamy animacjƒô podczas przeciƒÖgania
            };
            document.addEventListener('mousemove', (e) => {
                if (drag) {
                    el.style.left = (e.clientX - ox) + 'px';
                    el.style.top = (e.clientY - oy) + 'px';
                    el.style.right = 'auto'; // Resetujemy right
                }
            });
            document.addEventListener('mouseup', () => {
                drag = false;
                el.style.transition = 'opacity 0.3s ease';
            });
        }

        makeDraggable(document.getElementById('quick-add-window'), document.getElementById('qa-header'));
        makeDraggable(document.getElementById('editor-aside'), document.getElementById('editor-header'));

        document.getElementById('nav-all').onclick = () => window.setCollection('all');
        document.getElementById('nav-favs').onclick = () => window.setCollection('favs');
        document.getElementById('global-search').oninput = (e) => { searchQuery = e.target.value; renderFeed(); };

            const cursor = document.getElementById('custom-cursor');
            const input = document.getElementById('todo-input');
            const list = document.getElementById('todo-list');
            const btn = document.getElementById('add-btn');

            let mouseX = 0, mouseY = 0, cursorX = 0, cursorY = 0;
            const speed = 0.75;
            const MAX_CURSOR_SIZE = 40; // Maksymalna ≈õrednica kursora w pikselach

            function animate() {
                let distX = mouseX - cursorX;
                let distY = mouseY - cursorY;

                cursorX = cursorX + (distX * speed);
                cursorY = cursorY + (distY * speed);

                cursor.style.left = cursorX + 'px';
                cursor.style.top = cursorY + 'px';

                requestAnimationFrame(animate);
            }
            animate();

            document.addEventListener('mousemove', (e) => {
                mouseX = e.clientX;
                mouseY = e.clientY;
                cursor.classList.remove('cursor-hidden');
            });

            document.addEventListener('mousedown', () => cursor.classList.add('clicking'));
            document.addEventListener('mouseup', () => cursor.classList.remove('clicking'));
            document.addEventListener('mouseleave', () => cursor.classList.add('cursor-hidden'));
            document.addEventListener('mouseenter', () => cursor.classList.remove('cursor-hidden'));

            document.addEventListener('mouseover', (e) => {
                    const target = e.target;

                    // AKTUALIZACJA: Dodano target.closest('label')
                    const isButton = target.closest('button') ||
                        target.closest('a') ||
                        target.closest('[role="button"]') ||
                        target.closest('label'); // <--- To sprawi, ≈ºe spinacz zadzia≈Ça jak button

                    const isCheckbox = target.type === 'checkbox';
                    const isInput = (target.tagName === 'INPUT' && target.type === 'text') || target.tagName === 'TEXTAREA';

                    if (isInput) {
                        cursor.classList.add('text');
                        resetMagnetic();
                    } else if (isButton || isCheckbox) {
                        const magneticTarget = isButton || target;
                        const rect = magneticTarget.getBoundingClientRect();

                        cursor.classList.add('magnetic');
                        cursor.classList.remove('text');

                        const maxDim = Math.max(rect.width, rect.height);
                        const size = Math.min(maxDim - 4, MAX_CURSOR_SIZE);

                        cursor.style.width = size + 'px';
                        cursor.style.height = size + 'px';
                        cursor.style.borderRadius = '50%';
                    } else {
                        resetMagnetic();
                        cursor.classList.remove('text');
                    }
                });

            function resetMagnetic() {
                cursor.classList.remove('magnetic');
                cursor.style.width = '';
                cursor.style.height = '';
                cursor.style.borderRadius = '50%';
            }
    </script>
</body>

</html>
