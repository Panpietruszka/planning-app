<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architect Pro | Depth Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');

        :root {
            --bg-midnight: #0a0a0a;
            --bg-panel: #141414;
            --accent-blue: #0071e3;
            --text-main: #f5f5f7;
            --text-dim: #86868b;
            --border-subtle: rgba(255, 255, 255, 0.08);
        }

        body {
            background-color: var(--bg-midnight);
            color: var(--text-main);
            font-family: 'Inter', -apple-system, sans-serif;
            -webkit-font-smoothing: antialiased;
            overflow: hidden;
        }

        .app-container {
            display: grid;
            grid-template-columns: 320px 1fr;
            height: 100vh;
        }

        .sidebar {
            background: var(--bg-panel);
            border-right: 1px solid var(--border-subtle);
            overflow-y: auto;
        }

        .workspace {
            background: var(--bg-midnight);
            overflow-y: auto;
            position: relative;
        }

        .glass-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            transition: all 0.2s ease;
        }

        .glass-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.15);
        }

        input,
        textarea {
            background: #1c1c1e !important;
            border: 1px solid var(--border-subtle) !important;
            color: white !important;
            border-radius: 6px;
        }

        input:focus {
            outline: none;
            border-color: var(--accent-blue) !important;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 10px;
        }
    </style>
</head>

<body>

    <div class="app-container">
        <aside class="sidebar flex flex-col">
            <div class="p-6 border-b border-white/[0.05]">
                <div class="flex items-center gap-2 mb-1">
                    <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                    <h1 class="text-lg font-semibold tracking-tight">Architect Pro</h1>
                </div>
                <p class="text-[10px] text-gray-500 uppercase tracking-widest font-bold">Workspace</p>
            </div>

            <div class="p-4 flex-1">
                <button id="btn-new-project"
                    class="w-full py-2 mb-6 bg-white text-black text-sm font-medium rounded-lg hover:bg-gray-200 transition-all flex items-center justify-center gap-2">
                    <span>+</span> New Project
                </button>

                <nav id="project-nav" class="space-y-1">
                    <div class="text-xs text-gray-600 italic px-2">Initializing clusters...</div>
                </nav>
            </div>

            <div class="p-4 border-t border-white/[0.05] flex justify-between items-center">
                <div id="auth-status" class="text-[10px] font-mono text-gray-500">Connecting...</div>
                <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
            </div>
        </aside>

        <main class="workspace p-8 lg:p-12">
            <div id="active-project-view" class="max-w-4xl mx-auto">
                <div class="text-center mt-20 text-gray-600">
                    <svg class="mx-auto mb-4 opacity-20" width="64" height="64" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
                            d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
                        </path>
                    </svg>
                    <p class="text-lg">Select a project from the sidebar to begin architecting.</p>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, onSnapshot, updateDoc, deleteDoc, serverTimestamp, arrayUnion } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Twoja konfiguracja Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBvYHO1sYbPw35VRai37By4sqz0OKnml_0",
            authDomain: "architect-pro-839a5.firebaseapp.com",
            projectId: "architect-pro-839a5",
            storageBucket: "architect-pro-839a5.firebasestorage.app",
            messagingSenderId: "970538126376",
            appId: "1:970538126376:web:1d41594e31f0f9c19c391d",
            measurementId: "G-T3FR5WGQT2"
        };

        const appId = 'architect-pro-839a5';

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let projects = [];
        let activeProjectId = null;

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                document.getElementById('auth-status').innerText = `CLOUD_NODE: ${user.uid.substring(0, 6)}`;
                setupListeners();
            }
        });

        signInAnonymously(auth).catch(err => console.error("Auth error:", err));

        const setupListeners = () => {
            if (!currentUser) return;
            // Ścieżka do Twojej kolekcji projektów
            const projectsRef = collection(db, 'artifacts', appId, 'public', 'data', 'projects');
            onSnapshot(projectsRef, (snapshot) => {
                projects = [];
                snapshot.forEach(doc => projects.push({ id: doc.id, ...doc.data() }));
                renderSidebar();
                if (activeProjectId) renderWorkspace();
            }, (err) => console.error("Snapshot error:", err));
        };

        const addNewProject = async () => {
            if (!currentUser) return;
            const name = prompt("Enter Project Name:");
            if (!name) return;
            try {
                const docRef = await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'projects'), {
                    name,
                    branches: [],
                    createdAt: serverTimestamp(),
                    createdBy: currentUser.uid
                });
                activeProjectId = docRef.id;
            } catch (err) {
                console.error("Error adding project:", err);
            }
        };

        const addBranch = async (projectId) => {
            const name = prompt("Branch Name (e.g. Backend, UI, DevOps):");
            if (!name) return;
            const projRef = doc(db, 'artifacts', appId, 'public', 'data', 'projects', projectId);
            const newBranch = { id: crypto.randomUUID(), name, sections: [] };
            await updateDoc(projRef, { branches: arrayUnion(newBranch) });
        };

        const addSection = async (projectId, branchId) => {
            const name = prompt("Section Name:");
            if (!name) return;
            const project = projects.find(p => p.id === projectId);
            const updatedBranches = project.branches.map(b => {
                if (b.id === branchId) {
                    return { ...b, sections: [...b.sections, { id: crypto.randomUUID(), name, items: [] }] };
                }
                return b;
            });
            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'projects', projectId), { branches: updatedBranches });
        };

        const addItem = async (projectId, branchId, sectionId) => {
            const content = prompt("Specific Task/Item:");
            if (!content) return;
            const project = projects.find(p => p.id === projectId);
            const updatedBranches = project.branches.map(b => {
                if (b.id === branchId) {
                    const updatedSections = b.sections.map(s => {
                        if (s.id === sectionId) {
                            return { ...s, items: [...s.items, { id: crypto.randomUUID(), content, status: 'pending' }] };
                        }
                        return s;
                    });
                    return { ...b, sections: updatedSections };
                }
                return b;
            });
            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'projects', projectId), { branches: updatedBranches });
        };

        const deleteProject = async (id) => {
            if (confirm("Delete entire project?")) {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'projects', id));
                if (activeProjectId === id) activeProjectId = null;
            }
        };

        window.addNewProject = addNewProject;
        window.addBranch = addBranch;
        window.addSection = addSection;
        window.addItem = addItem;
        window.deleteProject = deleteProject;
        window.setActive = (id) => {
            activeProjectId = id;
            renderSidebar();
            renderWorkspace();
        };

        document.getElementById('btn-new-project').addEventListener('click', addNewProject);

        const renderSidebar = () => {
            const nav = document.getElementById('project-nav');
            nav.innerHTML = projects.map(p => `
                <div onclick="window.setActive('${p.id}')" class="group flex justify-between items-center px-3 py-2 rounded-lg cursor-pointer transition-colors ${activeProjectId === p.id ? 'bg-blue-600/20 text-blue-400' : 'hover:bg-white/[0.03] text-gray-400'}">
                    <span class="text-sm font-medium truncate">${p.name}</span>
                    <button onclick="event.stopPropagation(); window.deleteProject('${p.id}')" class="opacity-0 group-hover:opacity-100 text-xs hover:text-red-500 transition-opacity">
                        &times;
                    </button>
                </div>
            `).join('');
        };

        const renderWorkspace = () => {
            const view = document.getElementById('active-project-view');
            const project = projects.find(p => p.id === activeProjectId);
            if (!project) return;

            view.innerHTML = `
                <header class="flex justify-between items-end mb-12">
                    <div>
                        <h2 class="text-3xl font-bold tracking-tight">${project.name}</h2>
                        <p class="text-gray-500 text-sm">Hierarchy Blueprint</p>
                    </div>
                    <button onclick="window.addBranch('${project.id}')" class="px-4 py-2 bg-blue-600 rounded-lg text-xs font-semibold hover:bg-blue-500 transition-colors">
                        + New Branch
                    </button>
                </header>
                <div class="space-y-12">
                    ${project.branches.length === 0 ? '<p class="text-gray-600 italic">No branches defined. Click "+ New Branch" to start.</p>' : ''}
                    ${project.branches.map(branch => `
                        <div class="branch-container">
                            <div class="flex items-center gap-4 mb-6">
                                <h3 class="text-lg font-semibold text-gray-300 uppercase tracking-widest text-[11px] bg-white/5 px-3 py-1 rounded border border-white/10">${branch.name}</h3>
                                <div class="h-[1px] flex-1 bg-white/[0.05]"></div>
                                <button onclick="window.addSection('${project.id}', '${branch.id}')" class="text-[10px] font-bold text-blue-500 hover:underline">+ ADD SECTION</button>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pl-4">
                                ${branch.sections.map(section => `
                                    <div class="glass-item p-5">
                                        <div class="flex justify-between items-center mb-4">
                                            <h4 class="font-medium text-sm text-gray-200">${section.name}</h4>
                                            <button onclick="window.addItem('${project.id}', '${branch.id}', '${section.id}')" class="text-[10px] text-gray-500 hover:text-white">+ ITEM</button>
                                        </div>
                                        <ul class="space-y-3">
                                            ${section.items.map(item => `
                                                <li class="flex items-start gap-3 text-xs text-gray-400 bg-black/20 p-2 rounded border border-white/[0.02]">
                                                    <span class="mt-1 w-1.5 h-1.5 rounded-full bg-blue-500/50"></span>
                                                    ${item.content}
                                                </li>
                                            `).join('')}
                                        </ul>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        };
    </script>
</body>

</html>